<!doctype html><html lang=ch itemscope itemtype=http://schema.org/WebPage><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=icon href=https://eddieliu58.github.io/hugo-website/logo.png>
<title>
Composition API: setup() - Eddie Blog
</title><meta name=description content="vue3入門導讀-Composition API">
<meta name=author content="Eddie Liu">
<meta name=generator content="Hugo 0.93.2"><link rel=stylesheet href="https://eddieliu58.github.io/hugo-website/css/styles.min.198e036e07f9315c64ac8148645b37db60243e6e5206ead92c979b3286f18468.css" integrity="sha256-GY4Dbgf5MVxkrIFIZFs322AkPm5SBurZLJebMobxhGg=">
<meta property="og:title" content="Composition API: setup()">
<meta property="og:description" content="vue3入門導讀-Composition API">
<meta property="og:type" content="article">
<meta property="og:url" content="https://eddieliu58.github.io/hugo-website/blog/vue-composition-api/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2022-04-11T00:00:00+00:00">
<meta property="article:modified_time" content="2022-04-11T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Composition API: setup()">
<meta name=twitter:description content="vue3入門導讀-Composition API">
<meta itemprop=name content="Composition API: setup()">
<meta itemprop=description content="vue3入門導讀-Composition API"><meta itemprop=datePublished content="2022-04-11T00:00:00+00:00">
<meta itemprop=dateModified content="2022-04-11T00:00:00+00:00">
<meta itemprop=wordCount content="228">
<meta itemprop=keywords content="vue,Composition API,">
</head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
<a href=https://eddieliu58.github.io/hugo-website/ class="capitalize font-extrabold text-2xl">
<img src=https://eddieliu58.github.io/hugo-website/logo.png alt="Eddie Blog" class="h-8 max-w-full">
</a>
<button class="mobile-menu-button md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg>
</button>
<ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">
<li><a href=https://eddieliu58.github.io/hugo-website/blog>部落格</a></li><li><a href=https://eddieliu58.github.io/hugo-website/page/about/>關於我</a></li><li><a href=https://eddieliu58.github.io/hugo-website/tags>標籤</a></li><li class="grid place-items-center">
<span class="open-search inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</span>
</li><li class="grid place-items-center">
<span class="toggle-dark-mode inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg>
</span>
</li></ul></header><main class=flex-1>
<article class="container prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">
<h1 class="text-2xl font-bold mb-2">Composition API: setup()</h1><h5 class="text-sm flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><rect x="8" y="15" width="2" height="2"/></svg>
&nbsp;&bull;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
2&nbsp;
&nbsp;&bull;<svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 019 0 9 9 0 019 0"/><path d="M3 6a9 9 0 019 0 9 9 0 019 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
228&nbsp;
</h5>April 11, 2022
<p>此篇將紀錄 vue3 LifeCycle 一個比較大的改動，也就是 Composition API。
由於工作上還是使用 vue2，因此本篇會順便介紹 vue2 與 vue3 這部分的差異性。</p><h2 id=vue2-lifecycle>vue2 LifeCycle</h2><p>vue2 總共有 8 個 hook,網上有非常多講解 LifeCycle 的文章,這裡就不再貼測試每個 hook 的程式碼，直接快速帶過。
正常情況下會經歷四個 hook(beforeCreate、created、beforeMount 及 mounted),分別是以下的狀況:</p><ol>
<li>beforeCreate：el 和 data 並未初始化,還是 undefind 的狀態</li><li>created:此時完成了 data 的初始化，el 還沒有建立</li><li>beforeMount：完成了 el 和 data 的初始化</li><li>mounted:el 掛載完成</li></ol><p>若 data 有被更新,則會觸發 beforeUpdate 與 updated。
最後 beforeDestroy 及 destroyed 作者比較少用，但若有 el 需要此功能，可使用<code>destroy()</code>,此 el 被銷毀後這時 el 中的任何定義( data 、 methods&mldr;等)都已被解除綁定，代表在此做的任何操作都會失效，而整個 LifeCycle 最後能對 el 做事情的 hook 就是 beforeDestroy。</p><h2 id=vue3-lifecycle>vue3 LifeCycle</h2><p>進入到 vue3 後,LifeCycle hook function 的寫法有所改變，下面就直接來看一下新做法吧。</p><h3 id=定義-setup-函式>定義 setup 函式</h3><p>首先要定義 setup 函式，這個函式包含 data、methods、computed、lifecycle 等方法。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>script<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>import</span> json from <span style=color:#f1fa8c>&#34;../demo.json&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>import</span> card from <span style=color:#f1fa8c>&#34;./components/v-card/misc-media-width-text.vue&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>import</span> {
</span></span><span style=display:flex><span>    ref,
</span></span><span style=display:flex><span>    reactive,
</span></span><span style=display:flex><span>    onBeforeMount,
</span></span><span style=display:flex><span>    onMounted,
</span></span><span style=display:flex><span>    onBeforeUpdate,
</span></span><span style=display:flex><span>    onUpdated,
</span></span><span style=display:flex><span>    computed,
</span></span><span style=display:flex><span>  } from <span style=color:#f1fa8c>&#34;vue&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>export</span> <span style=color:#ff79c6>default</span> {
</span></span><span style=display:flex><span>    name<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;App&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    components<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>      card,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    setup() {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> ApiData <span style=color:#ff79c6>=</span> reactive([]);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> uri <span style=color:#ff79c6>=</span> ref(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>const</span> computedFun <span style=color:#ff79c6>=</span> computed(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> ApiData[<span style=color:#bd93f9>0</span>].length;
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      onBeforeMount(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// DOM 渲染前
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        console.log(<span style=color:#f1fa8c>&#34;DOM 渲染前&#34;</span>);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      onMounted(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// DOM 渲染完成後
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (process.env.VUE_APP_ENV <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;dev&#34;</span>) {
</span></span><span style=display:flex><span>          uri.value <span style=color:#ff79c6>=</span> process.env.VUE_APP_API_ENDPOINT_DEV;
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>this</span>.axios
</span></span><span style=display:flex><span>            .get(<span style=color:#f1fa8c>`</span><span style=color:#f1fa8c>${</span>uri.value<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>)
</span></span><span style=display:flex><span>            .then((response) =&gt; {
</span></span><span style=display:flex><span>              ApiData.push(response.data.attractions);
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>            .<span style=color:#ff79c6>catch</span>((error) =&gt; {
</span></span><span style=display:flex><span>              console.log(error);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>          ApiData.push(json.attractions);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      onBeforeUpdate(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// 在資料更改導致virtual DOM重新渲染前調用
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        console.log(<span style=color:#f1fa8c>&#34;資料更改前&#34;</span>);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      onUpdated(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// 在資料更改導致virtual DOM重新渲染後調用
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        console.log(<span style=color:#f1fa8c>&#34;資料更改後&#34;</span>);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>        ApiData,
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        computedFun,
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    methods<span style=color:#ff79c6>:</span> {},
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>/script&gt;
</span></span></code></pre></div><h2 id=參考資料>參考資料</h2><ol>
<li><a href=https://vuejs.org/guide/essentials/lifecycle.html>Vue.js - Lifecycle Hooks</a></li><li><a href=https://ithelp.ithome.com.tw/articles/10202949>Vue.js Core 30 天屠龍記(第 4 天): Vue 實體的生命週期</a></li><li><a href=https://ithelp.ithome.com.tw/articles/10259305>重構倒數第 29 天 - Vue2 Option API 轉換 Vue3 Composition API</a></li></ol></article><div class="bg-blue-100 dark:bg-gray-900">
<div class="container px-6 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
<div>
<div class="text-2xl font-bold mb-2">關注我</div><p class=opacity-60>如有任何問題,可從右方連結聯絡我或觀看其他資訊</p></div><ul class="flex justify-center gap-4">
<li>
<a href="https://tw.linkedin.com/in/%E5%BD%A5%E5%BB%B7-%E5%8A%89-04a1841aa?trk=people-guest_people_search-card" target=_blank rel=noopener aria-label=LinkedIn class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg>
</a>
</li><li>
<a href=https://github.com/EddieLiu58 target=_blank rel=noopener aria-label=GitHub class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li></ul></div></div></main><footer class="container p-6 mx-auto flex justify-between items-center">
<span class="text-sm font-light">
Copyright © 2022 - Eddie Liu · All rights reserved
</span>
<span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg>
</span>
</footer><div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
<div class="container max-w-3xl mx-auto p-12">
<div class=relative>
<div class="my-4 text-center text-2xl font-bold">Search</div><span class="p-2 absolute right-0 top-0 cursor-pointer close-search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</span>
</div><input type=search class="py-2 px-3 w-full dark:text-black border dark:border-transparent" placeholder="Enter search query">
<div class="search-results text-lg font-medium my-4 hidden">Results</div><ul class="search-list my-2">
</ul><div class="no-results text-center my-8 hidden">
<div class="text-xl font-semibold mb-2">No results found</div><p class="font-light text-sm">Try adjusting your search query</p></div></div></div><script src=https://eddieliu58.github.io/hugo-website/js/scripts.min.js></script>
<script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script>
<script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script>
</body></html>